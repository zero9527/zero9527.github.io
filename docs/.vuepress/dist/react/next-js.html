<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ç©ç©æœåŠ¡ç«¯æ¸²æŸ“ä¹‹ Next.js | zero9527çš„å°ç«™</title>
    <meta name="description" content="Just playing around">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/assets/css/0.styles.0eba1a71.css" as="style"><link rel="preload" href="/assets/js/app.5ad30cc8.js" as="script"><link rel="preload" href="/assets/js/2.2ae201dd.js" as="script"><link rel="preload" href="/assets/js/22.f01f7385.js" as="script"><link rel="prefetch" href="/assets/js/10.3009213d.js"><link rel="prefetch" href="/assets/js/11.fbedfd21.js"><link rel="prefetch" href="/assets/js/12.9b516911.js"><link rel="prefetch" href="/assets/js/13.6832d89b.js"><link rel="prefetch" href="/assets/js/14.c0d8c8c2.js"><link rel="prefetch" href="/assets/js/15.1de091b8.js"><link rel="prefetch" href="/assets/js/16.85809d58.js"><link rel="prefetch" href="/assets/js/17.9ce1b8b1.js"><link rel="prefetch" href="/assets/js/18.ddf3f356.js"><link rel="prefetch" href="/assets/js/19.5a67ff82.js"><link rel="prefetch" href="/assets/js/20.bdb19d86.js"><link rel="prefetch" href="/assets/js/21.79df5e91.js"><link rel="prefetch" href="/assets/js/23.669c260a.js"><link rel="prefetch" href="/assets/js/24.1733401a.js"><link rel="prefetch" href="/assets/js/25.c9884707.js"><link rel="prefetch" href="/assets/js/26.594be1af.js"><link rel="prefetch" href="/assets/js/27.ed2a5537.js"><link rel="prefetch" href="/assets/js/28.8ba18d13.js"><link rel="prefetch" href="/assets/js/3.addc2e4a.js"><link rel="prefetch" href="/assets/js/4.e892ad38.js"><link rel="prefetch" href="/assets/js/5.2f130325.js"><link rel="prefetch" href="/assets/js/6.b7a78bbb.js"><link rel="prefetch" href="/assets/js/7.3d69bdd7.js"><link rel="prefetch" href="/assets/js/8.926e8c25.js"><link rel="prefetch" href="/assets/js/9.7806405c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0eba1a71.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">zero9527çš„å°ç«™</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/zero9527" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/57c2df4175c4cd72901a8e7e" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/zero9527" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/57c2df4175c4cd72901a8e7e" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/zr-virtual-list.html" class="sidebar-link">zr-virtual-list é•¿åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨</a></li><li><a href="/react/keep-alive-comp.html" class="sidebar-link">ç®€å•å®ç°ä¸€ä¸ª React ç»„ä»¶ keep-alive</a></li><li><a href="/react/react-ts-template.html" class="sidebar-link">React+Typescripté¡¹ç›®è¸©è¸©å‘å‘</a></li><li><a href="/react/movie-db-web.html" class="sidebar-link">ä¸€ä¸ªè±†ç“£ç”µå½± MovieDob ç½‘é¡µç‰ˆ</a></li><li><a href="/react/react-keep-alive.html" class="sidebar-link">React åˆ—è¡¨ keep-alive çš„ä¸€ç§å†™æ³•</a></li><li><a href="/react/next-js.html" class="active sidebar-link">ç©ç©æœåŠ¡ç«¯æ¸²æŸ“ä¹‹ Next.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#å‰è¨€" class="sidebar-link">å‰è¨€</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿ" class="sidebar-link">ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿ</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_1ã€src-ç›®å½•ç»“æ„" class="sidebar-link">1ã€src ç›®å½•ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_2ã€npm-script" class="sidebar-link">2ã€npm script</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_3ã€é¡µé¢-head" class="sidebar-link">3ã€é¡µé¢ head</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_4ã€è·¯ç”±" class="sidebar-link">4ã€è·¯ç”±</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#_4-1-link-ç»„ä»¶" class="sidebar-link">4.1 link ç»„ä»¶</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_4-2-éè·¯ç”±ç»„ä»¶è·å–è·¯ç”±å‚æ•°" class="sidebar-link">4.2 éè·¯ç”±ç»„ä»¶è·å–è·¯ç”±å‚æ•°</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_4-3-è·¯ç”±è½¬æ¢" class="sidebar-link">4.3 è·¯ç”±è½¬æ¢</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_4-4-è·¯ç”±æ–¹æ³•" class="sidebar-link">4.4 è·¯ç”±æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_4-5-router-äº‹ä»¶" class="sidebar-link">4.5 Router äº‹ä»¶</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_5ã€app" class="sidebar-link">5ã€App</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_6ã€ç»„ä»¶" class="sidebar-link">6ã€ç»„ä»¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#_6-1-getinitialprops-å±æ€§ï¼š" class="sidebar-link">6.1 getInitialProps å±æ€§ï¼š</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_6-2-åŠ¨æ€-import" class="sidebar-link">6.2 åŠ¨æ€ import</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_7ã€è·¯å¾„åˆ«å" class="sidebar-link">7ã€è·¯å¾„åˆ«å</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_8ã€ä½¿ç”¨-scss" class="sidebar-link">8ã€ä½¿ç”¨ SCSS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#_8-1-sass" class="sidebar-link">8.1 SASS</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_9ã€antd" class="sidebar-link">9ã€antd</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#babelrc" class="sidebar-link">.babelrc</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#next-config-js" class="sidebar-link">next.config.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_10ã€çŠ¶æ€ç®¡ç†-mobx" class="sidebar-link">10ã€çŠ¶æ€ç®¡ç† MobX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#_10-1-é¡¹ç›®å…¥å£" class="sidebar-link">10.1 é¡¹ç›®å…¥å£</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_10-2-æ¨¡å—" class="sidebar-link">10.2 æ¨¡å—</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_10-3-æ¨¡å—ç®¡ç†è¾“å‡º" class="sidebar-link">10.3 æ¨¡å—ç®¡ç†è¾“å‡º</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_10-4-ç»„ä»¶ä½¿ç”¨" class="sidebar-link">10.4 ç»„ä»¶ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_11ã€æœåŠ¡ç«¯" class="sidebar-link">11ã€æœåŠ¡ç«¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#_11-1-server-ts" class="sidebar-link">11.1 server.ts</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_11-2-å†™ä¸ªæ¥å£" class="sidebar-link">11.2 å†™ä¸ªæ¥å£</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_12ã€æ„å»º" class="sidebar-link">12ã€æ„å»º</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_13ã€éƒ¨ç½²" class="sidebar-link">13ã€éƒ¨ç½²</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#_13-1-pm2" class="sidebar-link">13.1 pm2</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#_13-2-nginx" class="sidebar-link">13.2 Nginx</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#åç»­è¦æçš„ä¸œè¥¿" class="sidebar-link">åç»­è¦æçš„ä¸œè¥¿</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/next-js.html#æ•°æ®åº“" class="sidebar-link">æ•°æ®åº“</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#grahpql" class="sidebar-link">GrahpQL</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/next-js.html#ä¸€äº›é—®é¢˜" class="sidebar-link">ä¸€äº›é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/react/next-js.html#å‚è€ƒ" class="sidebar-link">å‚è€ƒ</a></li></ul></li><li><a href="/react/React-Hook.html" class="sidebar-link">React Hook ä¸€äº›ç”¨æ³•</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å°ç¨‹åº</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å…¶ä»–</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ç©ç©æœåŠ¡ç«¯æ¸²æŸ“ä¹‹-next-js"><a href="#ç©ç©æœåŠ¡ç«¯æ¸²æŸ“ä¹‹-next-js" class="header-anchor">#</a> ç©ç©æœåŠ¡ç«¯æ¸²æŸ“ä¹‹ Next.js</h1> <h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>åŸºäº React çš„æœåŠ¡ç«¯æ¸²æŸ“ SSR æ¡†æ¶ <a href="https://nextjs.org/learn/basics/getting-started" target="_blank" rel="noopener noreferrer">Next.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ
åŸºäº Vue çš„æœåŠ¡ç«¯æ¸²æŸ“ SSR æ¡†æ¶ <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener noreferrer">Nuxt.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</p> <h3 id="ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿ" class="header-anchor">#</a> ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“ï¼Ÿ</h3> <ul><li><p><strong>å‡å°‘é¦–å±ç™½å±æ—¶é—´</strong></p></li> <li><p><strong>SEO</strong>ï¼šSearch Engine Optimization å³æœç´¢å¼•æ“ä¼˜åŒ–ï¼›<br>
ç®€å•è¯´å°±æ˜¯ï¼Œç½‘é¡µåœ¨è¢«è¯·æ±‚çš„æ—¶å€™ï¼Œä»æœåŠ¡å™¨å‘å‡ºçš„å†…å®¹å¯ä»¥è¢«æœç´¢å¼•æ“çš„çˆ¬è™«çˆ¬åˆ°æ•°æ®ï¼Œ<br>
è¿™ä¸ªæ—¶å€™ä»æœç´¢å¼•æ“æœç´¢çš„å…³é”®å­—åŒ…å«åœ¨è¿™äº›å†…å®¹ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªç½‘å€çš„ä¿¡æ¯å°±æ›´å®¹æ˜“æ˜¾ç¤ºåœ¨æœç´¢ç»“æœä¸­~</p></li> <li><p><strong>å®¢æˆ·ç«¯æ¸²æŸ“</strong>ï¼šå‰ç«¯ SPA çš„å‡ºç°ï¼Œå¤§éƒ¨åˆ†çš„é¡µé¢å†…å®¹åœ¨æµè§ˆå™¨ç«¯é€šè¿‡å¼‚æ­¥è¯·æ±‚æ‹¿åˆ°æ•°æ®ï¼Œç„¶åæ¸²æŸ“ç”Ÿæˆï¼›<br>
è€Œä»æœåŠ¡å™¨å‘å‡ºçš„åªæ˜¯ä¸€ä¸ªæ²¡æœ‰å†…å®¹çš„ç©ºå£³ï¼Œæœç´¢å¼•æ“è‡ªç„¶çˆ¬ä¸åˆ°ä¸œè¥¿~</p></li> <li><p><strong>æœåŠ¡ç«¯æ¸²æŸ“</strong>ï¼šä»¥å‰çš„åç«¯ MCV æ¡†æ¶å°±æ˜¯ä½¿ç”¨æ¨¡æ¿åœ¨æœåŠ¡å™¨ä¸Šå°†å†…å®¹ç”Ÿæˆï¼Œç„¶åæµè§ˆå™¨æ¥æ”¶åˆ°æ•°æ®ç›´æ¥æ¸²æŸ“å°±å¯ä»¥äº†ï¼›<br>
è¿™ä¸ªæ—¶å€™ç½‘é¡µçš„å†…å®¹å·²ç»è·Ÿéšç½‘ç«™è¿‡æ¥ï¼Œä¸»è¦å†…å®¹ä¸éœ€è¦é¢å¤–çš„å¼‚æ­¥è¯·æ±‚è·å–ï¼Œ<br>
æœç´¢å¼•æ“çš„çˆ¬è™«å°±å¯ä»¥çˆ¬åˆ°è¿™äº›éå¼‚æ­¥è¯·æ±‚çš„æ•°æ®~</p></li> <li><p><strong>å‰ç«¯æ¡†æ¶çš„ SSR</strong>ï¼šä¸»è¦æ˜¯ <strong>å‰åç«¯åŒæ„</strong>ã€<strong>å¾®æœåŠ¡æ¥å£èšåˆ</strong> ç­‰ï¼›å½“ç„¶åªæ˜¯å½“ä½œæ¸²æŸ“å±‚æ˜¯æœ€ç®€å•çš„ï¼Œæ¥å£è¿™äº›å°±ç”±åç«¯å¤§ä½¬è´Ÿè´£å§ï¼›<br>
å¦‚ React/Vue/Angular éƒ½æœ‰ä½¿ç”¨ Node.js åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ•°æ®çš„æ¡†æ¶ï¼›<br>
å‰ç«¯ä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨ React/Vue/Angular æ¡†æ¶ï¼Œåªæ˜¯æŸäº›æ•°æ®æ”¾åœ¨äº†æœåŠ¡ç«¯ç”Ÿæˆ</p></li></ul> <hr> <p>æºç çœ‹ ğŸ‘‡<a href="https://github.com/zero9527/next-test" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œä»æœåŠ¡å™¨è¿‡æ¥çš„æ—¶å€™å·²ç»æœ‰å†…å®¹äº†ï¼š
<img src="https://s1.ax1x.com/2020/06/20/NltrB6.png" alt="é¢„è§ˆå›¾"></p> <p>åç»­çš„è·¯ç”±å˜åŒ–å°±ç›¸å½“äº <strong>å•é¡µé¢ SPA</strong> äº†ï¼Œä½†æ˜¯åœ¨æŸä¸ªè·¯ç”±ä¸‹åˆ·æ–°ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯ç”±ä¹Ÿå°±æ˜¯ <strong>æœåŠ¡ç«¯æ¸²æŸ“</strong> çš„</p> <h2 id="_1ã€src-ç›®å½•ç»“æ„"><a href="#_1ã€src-ç›®å½•ç»“æ„" class="header-anchor">#</a> 1ã€src ç›®å½•ç»“æ„</h2> <div class="language- extra-class"><pre class="language-text"><code>.
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ header
â”‚   â”œâ”€â”€ hello-world
â”‚   â””â”€â”€ layout
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ _app.tsx
â”‚   â”œâ”€â”€ _error.tsx
â”‚   â”œâ”€â”€ about.tsx
â”‚   â”œâ”€â”€ detail.tsx
â”‚   â””â”€â”€ index.tsx
â”œâ”€â”€ store
â”‚   â”œâ”€â”€ home.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ styles
    â”œâ”€â”€ _error.scss
    â”œâ”€â”€ about.scss
    â”œâ”€â”€ detail.scss
    â””â”€â”€ index.scss
</code></pre></div><p><img src="https://s1.ax1x.com/2020/06/20/NltDnx.png" alt="é¢„è§ˆå›¾"></p> <h2 id="_2ã€npm-script"><a href="#_2ã€npm-script" class="header-anchor">#</a> 2ã€npm script</h2> <p>tsc éœ€è¦å®‰è£…</p> <div class="language- extra-class"><pre class="language-text"><code>yarn install typescript -g
</code></pre></div><h2 id="_3ã€é¡µé¢-head"><a href="#_3ã€é¡µé¢-head" class="header-anchor">#</a> 3ã€é¡µé¢ head</h2> <p>è®¾ç½®é¡µé¢ head</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Head <span class="token keyword">from</span> <span class="token string">'next/head'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Header</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Next<span class="token punctuation">.</span>js test<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width,initial-scale=1&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://s1.ax1x.com/2020/06/20/NltsHK.png" alt="é¢„è§ˆå›¾"></p> <p>å¯ä»¥åœ¨éœ€è¦ä¿®æ”¹é¡µé¢ head çš„åœ°æ–¹ä½¿ç”¨ï¼Œå¦‚ <code>/about</code> éœ€è¦ä¿®æ”¹ é¡µé¢<code>title</code> ä¸º aboutï¼›<br> æ˜¯å¢é‡ä¿®æ”¹çš„æ–¹å¼ï¼šæ²¡æœ‰åˆ™æ·»åŠ ï¼Œæœ‰åˆ™ä¿®æ”¹</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// ...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Head</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">about</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Head</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">// ...</span>
</code></pre></div><h2 id="_4ã€è·¯ç”±"><a href="#_4ã€è·¯ç”±" class="header-anchor">#</a> 4ã€è·¯ç”±</h2> <p><code>pages</code> ç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆè·¯ç”±ï¼Œå±‚çº§åªèƒ½æ˜¯ä¸€å±‚ å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ç¬¬ä¸€ç§å†™æ³•</span>
pages <span class="token operator">/</span> home<span class="token punctuation">.</span>tsx<span class="token punctuation">;</span>
pages <span class="token operator">/</span> detail<span class="token punctuation">.</span>tsx<span class="token punctuation">;</span>

styles <span class="token operator">/</span> home<span class="token punctuation">.</span>scss<span class="token punctuation">;</span>
styles <span class="token operator">/</span> detail<span class="token punctuation">.</span>scss<span class="token punctuation">;</span>

<span class="token comment">// è€Œä¸æ˜¯</span>
<span class="token comment">// ç¬¬äºŒç§å†™æ³•</span>
pages <span class="token operator">/</span> home <span class="token operator">/</span> index<span class="token punctuation">.</span>tsx<span class="token punctuation">;</span>
pages <span class="token operator">/</span> home <span class="token operator">/</span> home<span class="token punctuation">.</span>scss<span class="token punctuation">;</span>
</code></pre></div><blockquote><ul><li><code>pages/</code> ä¸‹ ä¸èƒ½æ˜¯æ–‡ä»¶å¤¹ï¼ˆæ­£å¸¸æ¥è¯´è¿˜æœ‰ä¸ª cssï¼Œä½†æ˜¯ä½¿ç”¨æ–‡ä»¶å¤¹çš„è¯ï¼Œå¼€å‘é˜¶æ®µæ­£å¸¸ï¼Œbuild æ—¶ ä¼šæŠ¥ scss æ–‡ä»¶ä¸æ˜¯ React ç»„ä»¶ã€‚ã€‚ã€‚æ‰€ä»¥åœ¨å¤–é¢æ–°å»º <code>styles</code> æ–‡ä»¶å¤¹ï¼Œæ”¾å„è‡ªè·¯ç”±ç»„ä»¶çš„ scss æ–‡ä»¶ï¼‰</li> <li>å…¶ä»–æ–‡ä»¶å¤¹å¦‚ <code>components</code> ä¸ä¼šæŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬äºŒç§å†™æ³•ï¼Œæ ·å¼è·Ÿç»„ä»¶åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹</li></ul></blockquote> <h3 id="_4-1-link-ç»„ä»¶"><a href="#_4-1-link-ç»„ä»¶" class="header-anchor">#</a> 4.1 link ç»„ä»¶</h3> <ul><li>href: è·¯ç”±ï¼Œå¦‚ <code>href=&quot;about&quot;</code> ï¼Œåˆ™ä¼šæ¸²æŸ“ <code>page/about.tsx</code> çš„å†…å®¹</li> <li>as: å°† <code>href</code> é‡å‘½åç„¶åæµè§ˆå™¨åœ°å€æ˜¾ç¤ºçš„æ˜¯è¿™ä¸ª URLï¼›<br>
href çš„è·¯ç”±å¿…é¡»æ­£ç¡®ï¼Œéœ€è¦æœ‰ä¸€ä¸ªå®é™…ä¸Šåœ¨ page ç›®å½•ä¸­å­˜åœ¨çš„æ–‡ä»¶</li> <li>prefetch: é¢„å–ï¼Œå½“å‰é¡µé¢ä¼šç”¨åˆ°</li></ul> <h4 id="href-as"><a href="#href-as" class="header-anchor">#</a> href/as</h4> <p>å¦‚ä¸‹å°†æµè§ˆå™¨ URL æ˜¾ç¤ºä¸º about1ï¼Œå¦‚æœæœåŠ¡ç«¯ä¸å¦å¤–æ‹¦æˆªè·¯ç”±çš„è¯ï¼Œå®é™…ä¸Šæ¸²æŸ“çš„æ˜¯ pages/about.tsx æ–‡ä»¶ï¼Œå®é™…çš„è·¯ç”±ä¹Ÿæ˜¯å¦‚æ­¤</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/about&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>About<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦‚æœè®¾ç½®äº† as åˆ«åï¼Œå¹¶ä¸”ä¸åŸæ¥çš„è·¯ç”±ä¸ä¸€æ ·äº†ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯å¦å¤–è®¾ç½®è·¯ç”±ï¼›</p> <p>å¦‚ä¸‹ï¼š</p> <ul><li>å®¢æˆ·ç«¯</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/detail?id=123&quot;</span> <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">&quot;/detail/123&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>a style<span class="token operator">=</span><span class="token punctuation">{</span>linkStyle<span class="token punctuation">}</span><span class="token operator">&gt;</span>Detail<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre></div><ul><li>æœåŠ¡ç«¯</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// server.ts</span>
server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/detail/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Req<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'/detail'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="prefetchï¼ˆæ¥è‡ªæ–‡æ¡£ï¼‰ï¼š"><a href="#prefetchï¼ˆæ¥è‡ªæ–‡æ¡£ï¼‰ï¼š" class="header-anchor">#</a> prefetchï¼ˆæ¥è‡ª<a href="https://nextjs.org/docs#prefetching-pages" target="_blank" rel="noopener noreferrer">æ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰ï¼š</h4> <p>æœ‰äº›æ“ä½œå¯èƒ½éœ€è¦å»¶è¿Ÿï¼Œä½†å¯ä»¥ä½¿ç”¨ prefetch é¢„å–æ•°æ®</p> <ul><li>Link ç»„ä»¶</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/about<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prefetch</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>å‘½ä»¤å¼</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> withRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyLink</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> router <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>a onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/dynamic'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token constant">A</span> route transition will happen after <span class="token number">100</span>ms
      <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token comment">// but we can prefetch it!</span>
      router<span class="token punctuation">.</span><span class="token function">prefetch</span><span class="token punctuation">(</span><span class="token string">'/dynamic'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>MyLink<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="push-replace"><a href="#push-replace" class="header-anchor">#</a> push/replace</h4> <ul><li>å¯¹è±¡</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    pathname<span class="token operator">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
    query<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Zeit'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ReadMore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      Click <span class="token operator">&lt;</span>span onClick<span class="token operator">=</span><span class="token punctuation">{</span>handler<span class="token punctuation">}</span><span class="token operator">&gt;</span>here<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> to read more
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ReadMore<span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-2-éè·¯ç”±ç»„ä»¶è·å–è·¯ç”±å‚æ•°"><a href="#_4-2-éè·¯ç”±ç»„ä»¶è·å–è·¯ç”±å‚æ•°" class="header-anchor">#</a> 4.2 éè·¯ç”±ç»„ä»¶è·å–è·¯ç”±å‚æ•°</h3> <p>è¿™ä¸ªå’Œ React ä¸€æ ·ï¼Œä½¿ç”¨ <code>withRouter</code> è·å–è·¯ç”±å‚æ•°ï¼Œä¸è¿‡è¿™ä¸ªæ˜¯ä» <code>next/router</code> å¯¼å‡ºçš„ï¼›å‡½æ•°ç»„ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>useRouter</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/components/header/index.tsx</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Head <span class="token keyword">from</span> <span class="token string">'next/head'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./header.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Header</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Next<span class="token punctuation">.</span>js test<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width,initial-scale=1&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>tag<span class="token punctuation">}</span><span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/about&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>tag<span class="token punctuation">}</span><span class="token operator">&gt;</span>About<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/detail?id=123&quot;</span> <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">&quot;/detail/123&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>tag<span class="token punctuation">}</span><span class="token operator">&gt;</span>Detail<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Header<span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-3-è·¯ç”±è½¬æ¢"><a href="#_4-3-è·¯ç”±è½¬æ¢" class="header-anchor">#</a> 4.3 è·¯ç”±è½¬æ¢</h3> <ul><li>å°† <code>href=&quot;/detail?id=123&quot;</code> çš„ <strong>query æŸ¥è¯¢çš„ URL</strong> è½¬æ¢ä¸º <code>as=&quot;/detail/123&quot;</code> çš„ <strong>params å¼ URL</strong>ï¼›<br>
href/as æ˜¯é™æ€çš„ï¼Œæœ‰éœ€è¦çš„è¯åŠ¨æ€ç”Ÿæˆ <code>&lt;Link&gt;</code> å³å¯</li></ul> <p><img src="https://s1.ax1x.com/2020/06/20/Nlt0j1.png" alt="é¢„è§ˆå›¾"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/detail?id=123&quot;</span> <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">&quot;/detail/123&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>a className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>tag<span class="token punctuation">}</span><span class="token operator">&gt;</span>Detail<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>æœåŠ¡ç«¯åŒ¹é… URL ä¸º <code>/detail/:id</code> çš„è·¯ç”±ï¼Œ<br>
æ·»åŠ  <code>params å‚æ•°</code>ï¼Œç„¶åæ¸²æŸ“ <code>/detail</code> å¯¹åº”çš„ <code>page/detail.tsx</code> æ–‡ä»¶;<br>
å¦‚æœä¸åœ¨æœåŠ¡ç«¯è®¾ç½®å¯¹åº”çš„è·¯ç”±æ‹¦æˆªçš„è¯ï¼Œåˆ·æ–°ä¼šå¯¼è‡´ 404</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// server.ts</span>
<span class="token comment">// ...</span>

<span class="token keyword">function</span> <span class="token function">serverRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// apiæ¥å£</span>
  <span class="token keyword">const</span> controllers <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./server/controller'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> apiRoute <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// '/web';</span>
  server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>apiRoute<span class="token punctuation">,</span> controllers<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åŒ¹é…URLä¸º `/` çš„è·¯ç”±ï¼Œç„¶åæ¸²æŸ“ `/` å¯¹åº”çš„ `page/index.tsx` æ–‡ä»¶</span>
  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Req<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åŒ¹é…URLä¸º `/about` çš„è·¯ç”±ï¼Œç„¶åæ¸²æŸ“ `/about` å¯¹åº”çš„ `page/about.tsx` æ–‡ä»¶</span>
  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Req<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'/about'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åŒ¹é…URLä¸º `/detail/:id` çš„è·¯ç”±ï¼Œæ·»åŠ  `params å‚æ•°`ï¼Œç„¶åæ¸²æŸ“ `/detail` å¯¹åº”çš„ `page/detail.tsx` æ–‡ä»¶</span>
  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/detail/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Req<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'/detail'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> http<span class="token punctuation">.</span>IncomingMessage<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt; Ready on http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-4-è·¯ç”±æ–¹æ³•"><a href="#_4-4-è·¯ç”±æ–¹æ³•" class="header-anchor">#</a> 4.4 è·¯ç”±æ–¹æ³•</h3> <h4 id="è·¯ç”±æ‹¦æˆª-router-beforepopstate"><a href="#è·¯ç”±æ‹¦æˆª-router-beforepopstate" class="header-anchor">#</a> è·¯ç”±æ‹¦æˆª Router.beforePopState</h4> <p>åœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œï¼Œéœ€è¦ç»„ä»¶åŠ è½½å®Œ <code>componentDidMount/useEffect</code> æ‰§è¡Œï¼Œä¸ç„¶ä¼šæŠ¥é”™</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/pages/index.tsx</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token comment">/* Router, */</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@/components/layout'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'@/styles/index.scss'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * é¦–é¡µï¼Œè·¯ç”±ä¸º '/'
 * @param props
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·¯ç”±æ‹¦æˆªï¼Œä¼šå½±å“æµè§ˆå™¨å‰è¿›åé€€çš„æ¸²æŸ“ç»“æœ</span>
    <span class="token comment">// Router.beforePopState(({ url, as, options }: any) =&gt; {</span>
    <span class="token comment">//   console.log('url: ', url);</span>
    <span class="token comment">//   console.log('as: ', as);</span>
    <span class="token comment">//   console.log('options: ', options);</span>
    <span class="token comment">//   if (as === '/about') {</span>
    <span class="token comment">//     console.log('about');</span>
    <span class="token comment">//     return true;</span>
    <span class="token comment">//   }</span>
    <span class="token comment">//   return true;</span>
    <span class="token comment">// });</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>img
        className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>img<span class="token punctuation">}</span>
        src<span class="token operator">=</span><span class="token string">&quot;/static/images/4k-wallpaper-alps-cold-2283757.jpg&quot;</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>content<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          This is our blog post<span class="token punctuation">.</span> Yes<span class="token punctuation">.</span> We can have a<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/link&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>link<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
          <span class="token punctuation">.</span> And we can have a title <span class="token keyword">as</span> well<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>This is a title<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>And here's the content<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home<span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-5-router-äº‹ä»¶"><a href="#_4-5-router-äº‹ä»¶" class="header-anchor">#</a> 4.5 Router äº‹ä»¶</h3> <h4 id="ç›‘å¬è·¯ç”±çš„å†…éƒ¨äº‹ä»¶ï¼š"><a href="#ç›‘å¬è·¯ç”±çš„å†…éƒ¨äº‹ä»¶ï¼š" class="header-anchor">#</a> ç›‘å¬è·¯ç”±çš„å†…éƒ¨äº‹ä»¶ï¼š</h4> <ul><li>routeChangeStart(url) - è·¯ç”±å¼€å§‹å˜åŒ–çš„æ—¶å€™è§¦å‘</li> <li>routeChangeComplete(url) - è·¯ç”±å®Œæˆå˜åŒ–ä¹‹åè§¦å‘</li> <li>routeChangeError(err, url) - è·¯ç”±å˜åŒ–å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘</li> <li>beforeHistoryChange(url) - æ”¹å˜æµè§ˆå™¨å†å²çºªå½•ä¹‹å‰è§¦å‘</li> <li>hashChangeStart(url) - hash å¼€å§‹å˜åŒ–çš„æ—¶å€™è§¦å‘</li> <li>hashChangeComplete(url) - hash å®Œæˆå˜åŒ–ä¹‹åè§¦å‘</li></ul> <p>ç¤ºä¾‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleRouteChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App is changing to: '</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Router<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'routeChangeStart'</span><span class="token punctuation">,</span> handleRouteChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="è·¯ç”±è·³è½¬"><a href="#è·¯ç”±è·³è½¬" class="header-anchor">#</a> è·¯ç”±è·³è½¬</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ­£å¸¸è·¯ç”±è·³è½¬ï¼Œåœ¨abouté¡µé¢è·å–è·¯ç”±ä¿¡æ¯çš„æ—¶å€™ï¼Œidä¸ºa11ï¼Œ</span>
<span class="token comment">// åˆ·æ–°é¡µé¢åˆ™idä¸ºasssï¼Œæ‰€ä»¥å°½é‡äºŒè€…ä¸€è‡´ï¼Œé¿å…ä¸å¿…è¦çš„é—®é¢˜</span>
Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/about?id=a11'</span><span class="token punctuation">,</span> <span class="token string">'/about/asss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>Shallow Routingï¼šæµ…è·¯ç”±</strong></li></ul> <p>ä¸æ‰§è¡Œ getInitialProps çš„æƒ…å†µä¸‹ä¿®æ”¹é¡µé¢ URL,</p> <div class="language-js extra-class"><pre class="language-js"><code>Router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/about?id=a11'</span><span class="token punctuation">,</span> <span class="token string">'/about/asss'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> shallow<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5ã€app"><a href="#_5ã€app" class="header-anchor">#</a> 5ã€App</h2> <p>_app ç»„ä»¶ä¸ä¼šè¢«é”€æ¯ï¼Œé™¤éæ‰‹åŠ¨åˆ·æ–°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/pages/_app.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextComponentType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;next&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App<span class="token punctuation">,</span> <span class="token punctuation">{</span> AppProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/app'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>
  Component<span class="token operator">:</span> NextComponentType<span class="token punctuation">,</span>
  pageProps<span class="token operator">:</span> AppProps<span class="token punctuation">,</span>
  router<span class="token operator">:</span> Router
<span class="token punctuation">}</span>

<span class="token comment">/**
 * App
 */</span>
<span class="token keyword">class</span> <span class="token class-name">myApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'router: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'router: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> pageProps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>pageProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> myApp<span class="token punctuation">;</span>
</code></pre></div><h2 id="_6ã€ç»„ä»¶"><a href="#_6ã€ç»„ä»¶" class="header-anchor">#</a> 6ã€ç»„ä»¶</h2> <h3 id="_6-1-getinitialprops-å±æ€§ï¼š"><a href="#_6-1-getinitialprops-å±æ€§ï¼š" class="header-anchor">#</a> 6.1 getInitialProps å±æ€§ï¼š</h3> <p>æ¥æ”¶ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢è·å–æ•°æ®ï¼Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“ï¼›åªèƒ½åœ¨ pages/ ä¸‹çš„ç»„ä»¶ä½¿ç”¨ <a href="https://nextjs.org/docs#fetching-data-and-component-lifecycle" target="_blank" rel="noopener noreferrer">æ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>åœ¨å½“å‰è·¯ç”±åˆ·æ–°æ‰ä¼šåœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå¦‚æœæ˜¯ä»å…¶ä»–è·¯ç”±è·³è½¬è¿‡æ¥çš„ï¼Œæ²¡æœ‰åˆ·æ–°é¡µé¢å°±ä¼šåœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œçš„ï¼›</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/pages/detail.tsx</span>
<span class="token keyword">import</span> Head <span class="token keyword">from</span> <span class="token string">'next/head'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject<span class="token punctuation">,</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> homeStoreType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/home'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Row <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@/components/layout'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'@/styles/detail.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Detail</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> homeStore<span class="token operator">:</span> homeStoreType <span class="token operator">=</span> props<span class="token punctuation">.</span>homeStore<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Detail<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>detail<span class="token punctuation">}</span><span class="token operator">&gt;</span>This is the detail page<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      id<span class="token operator">:</span> <span class="token punctuation">{</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Row<span class="token operator">&gt;</span>count<span class="token operator">:</span> <span class="token punctuation">{</span>homeStore<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Row<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> homeStore<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>homeStore<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        count<span class="token operator">++</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Detail<span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * åœ¨å½“å‰è·¯ç”±åˆ·æ–°çš„è¯ï¼Œcontext.req ä¸ºçœŸï¼ŒæœåŠ¡ç«¯æ‰æœ‰ req/resï¼Œåœ¨å‘½ä»¤è¡Œæ‰“å° 'broswer'ï¼›
   * å¦‚æœæ˜¯å…¶ä»–è·¯ç”±è·³è½¬è¿‡æ¥æ²¡æœ‰åˆ·æ–°é¡µé¢çš„è¯ï¼Œcontext.req ä¸ºå‡ï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰“å°,
   * æ­¤æ—¶ document.title æ˜¯ è·³è½¬ä¹‹å‰çš„é¡µé¢ titleï¼›
   */</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render-type: '</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>req <span class="token operator">?</span> <span class="token string">'server'</span> <span class="token operator">:</span> <span class="token string">'broswer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// data: 'detail'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> DetailWithMobx <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'homeStore'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">observer</span><span class="token punctuation">(</span>Detail<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DetailWithMobx<span class="token punctuation">;</span>
</code></pre></div><p>æ¥æ”¶çš„æ–¹æ³•æœ‰ä¸€ä¸ªå½¢å‚ <code>context = { pathname, query, asPath, req, res, err }</code>ï¼š</p> <ul><li>pathname: URL pathname ä¸­çš„å›ºå®šçš„éƒ¨åˆ†ï¼Œå¦‚ å®šä¹‰çš„<code>/post/:id</code>ï¼Œåˆ™è¿™é‡Œ pathname ä¸º<code>/post</code></li> <li>query: URL çš„æŸ¥è¯¢å‚æ•°çš„å¯¹è±¡</li> <li>asPath - å®šä¹‰çš„è·¯ç”±ï¼Œå¦‚ <code>/post/:id</code></li> <li>req: HTTP request object (server only)</li> <li>res: HTTP response object (server only)</li> <li>err: æ¸²æŸ“æœŸé—´çš„æŠ¥é”™</li></ul> <h3 id="_6-2-åŠ¨æ€-import"><a href="#_6-2-åŠ¨æ€-import" class="header-anchor">#</a> 6.2 åŠ¨æ€ import</h3> <p>ä½¿ç”¨ <code>dynamic</code> å’Œ <code>import()</code> å®ç°åŠ¨æ€ç»„ä»¶ï¼›<br>
dynamic ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œloading å­—æ®µæ˜¯åŠ è½½å®Œæˆå‰çš„ loading</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/components/about.tsx</span>
<span class="token keyword">import</span> dynamic <span class="token keyword">from</span> <span class="token string">'next/dynamic'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Head <span class="token keyword">from</span> <span class="token string">'next/head'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@/components/layout'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'@/styles/about.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Hello <span class="token operator">=</span> <span class="token function">dynamic</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/hello-world/index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">loading</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">About</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>about<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>about<span class="token punctuation">}</span><span class="token operator">&gt;</span>This is the about page<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Hello <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// About.getInitialProps = async function(context: any) {</span>
<span class="token comment">//   return {</span>
<span class="token comment">//     data: 'about'</span>
<span class="token comment">//   };</span>
<span class="token comment">// }</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> About<span class="token punctuation">;</span>
</code></pre></div><h2 id="_7ã€è·¯å¾„åˆ«å"><a href="#_7ã€è·¯å¾„åˆ«å" class="header-anchor">#</a> 7ã€è·¯å¾„åˆ«å</h2> <p>ä½¿ç”¨ <code>babel-plugin-module-alias</code>ï¼Œç›´æ¥é…ç½® webpack æ˜¯æ— æ•ˆçš„</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add babel-plugin-module-alias -D
</code></pre></div><ul><li>é…ç½® .babelrc</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;plugins&quot;: [
    [&quot;module-alias&quot;, { &quot;src&quot;: &quot;./src&quot;, &quot;expose&quot;: &quot;@&quot; }]
  ],
  &quot;presets&quot;: [
    &quot;next/babel&quot;,
  ]
}
</code></pre></div><ul><li>tsconfig.json</li></ul> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;compilerOptions&quot;: {
    ...
    &quot;baseUrl&quot;: &quot;src&quot;,
    &quot;paths&quot;: {
      &quot;@/*&quot;: [&quot;./*&quot;]
    },
  },
  ...
}
</code></pre></div><h2 id="_8ã€ä½¿ç”¨-scss"><a href="#_8ã€ä½¿ç”¨-scss" class="header-anchor">#</a> 8ã€ä½¿ç”¨ SCSS</h2> <p><strong>å®˜æ–¹æ’ä»¶ï¼š</strong> <a href="https://github.com/zeit/next-plugins/tree/master/packages/next-sass" target="_blank" rel="noopener noreferrer">@zeit/next-sass<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_8-1-sass"><a href="#_8-1-sass" class="header-anchor">#</a> 8.1 SASS</h3> <h4 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h4> <div class="language- extra-class"><pre class="language-text"><code>npm install --save @zeit/next-sass node-sass
</code></pre></div><p>æˆ–</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add @zeit/next-sass node-sass
</code></pre></div><h4 id="é…ç½®"><a href="#é…ç½®" class="header-anchor">#</a> é…ç½®</h4> <p>é…ç½®åï¼Œä½¿ç”¨è·Ÿ react é‡Œé¢ä½¿ç”¨ CSS modules ä¸€æ ·</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// next.config.js</span>
<span class="token keyword">const</span> withSass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@zeit/next-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">withSass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cssModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// é»˜è®¤ falseï¼Œå³å…¨å±€æœ‰æ•ˆ</span>
  cssLoaderOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    importLoaders<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    localIdentName<span class="token operator">:</span> <span class="token string">'[local]___[hash:base64:5]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ–è€…è‡ªå®šä¹‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// next.config.js</span>
<span class="token keyword">const</span> withSass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@zeit/next-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">withSass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ä½¿ç”¨-postcss"><a href="#ä½¿ç”¨-postcss" class="header-anchor">#</a> ä½¿ç”¨ postcss</h4> <p>é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ postcss.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">{</span>
    autoprefixer<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_9ã€antd"><a href="#_9ã€antd" class="header-anchor">#</a> 9ã€antd</h2> <p>å‚è€ƒè¿™ä½å¤§ä½¬çš„ <a href="https://www.cnblogs.com/1wen/p/10793868.html" target="_blank" rel="noopener noreferrer">æ–‡ç« <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ
ä¸»è¦å°±æ˜¯ <code>cssModules</code> å’Œ <code>antdæŒ‰éœ€åŠ è½½</code> ä¸€èµ·ä½¿ç”¨çš„é—®é¢˜ï¼Œå…¶ä»–çš„æŒ‰ç…§ antd å®˜ç½‘çš„æå°±å¯ä»¥ï¼Œantd-mobile åªè¦å°† ç›¸åº”çš„ antd æ”¹ä¸º antd-mobile å°±å¯ä»¥äº†</p> <h3 id="babelrc"><a href="#babelrc" class="header-anchor">#</a> .babelrc</h3> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;plugins&quot;: [
    // &quot;transform-decorators-legacy&quot;,
    [&quot;@babel/plugin-proposal-decorators&quot;, { &quot;legacy&quot;: true }],
    [&quot;module-alias&quot;, { &quot;src&quot;: &quot;./src&quot;, &quot;expose&quot;: &quot;@&quot; }],
    [&quot;import&quot;, { &quot;libraryName&quot;: &quot;antd&quot;, &quot;style&quot;: &quot;css&quot; }]
  ],
  &quot;presets&quot;: [
    &quot;next/babel&quot;,
  ]
}
</code></pre></div><h3 id="next-config-js"><a href="#next-config-js" class="header-anchor">#</a> next.config.js</h3> <p>ä»¥ä¸‹æ˜¯å…¬å…±é…ç½®ï¼Œä¼šåˆå¹¶åˆ° next.config.js çš„é…ç½®ä¸­</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config/config.common.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cssLoaderGetLocalIdent <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'css-loader/lib/getLocalIdent.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// const isProd = process.env.NODE_ENV === 'production';</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> require <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  require<span class="token punctuation">.</span>extensions<span class="token punctuation">[</span><span class="token string">'.css'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* å…¬å…±é…ç½® */</span>
<span class="token keyword">let</span> configCommon <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// assetPrefix: isProd ? 'https://cdn.mydomain.com' : '',</span>
  crossOrigin<span class="token operator">:</span> <span class="token string">'anonymous'</span><span class="token punctuation">,</span>
  cssModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  cssLoaderOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    importLoaders<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    localIdentName<span class="token operator">:</span> <span class="token string">'[local]___[hash:base64:5]'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getLocalIdent</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> localIdentName<span class="token punctuation">,</span> localName<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hz <span class="token operator">=</span> context<span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>rootContext<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// æ’é™¤ node_modules ä¸‹çš„æ ·å¼</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/node_modules/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>hz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> localName<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">cssLoaderGetLocalIdent</span><span class="token punctuation">(</span>
        context<span class="token punctuation">,</span>
        localIdentName<span class="token punctuation">,</span>
        localName<span class="token punctuation">,</span>
        options
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  distDir<span class="token operator">:</span> <span class="token string">'next-build'</span><span class="token punctuation">,</span> <span class="token comment">// æ„å»ºè¾“å‡ºç›®å½•ï¼Œé»˜è®¤ '.next'</span>
  generateEtags<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// æ§åˆ¶ç¼“å­˜çš„ etagï¼Œé»˜è®¤ true</span>
  pageExtensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'tsx'</span><span class="token punctuation">,</span> <span class="token string">'jsx'</span><span class="token punctuation">,</span> <span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'scss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// pagesæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åç¼€</span>
  <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>externals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è§£å†³ æ‰“åŒ…cssæŠ¥é”™é—®é¢˜</span>
      <span class="token keyword">const</span> includes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token regex">/antd/</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      config<span class="token punctuation">.</span>externals <span class="token operator">=</span> config<span class="token punctuation">.</span>externals<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">external</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> external <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> external<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> req<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> includes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">include</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            req<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
              <span class="token operator">?</span> include<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token operator">:</span> include<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
            <span class="token operator">?</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token function">external</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> configCommon<span class="token punctuation">;</span>
</code></pre></div><h2 id="_10ã€çŠ¶æ€ç®¡ç†-mobx"><a href="#_10ã€çŠ¶æ€ç®¡ç†-mobx" class="header-anchor">#</a> 10ã€çŠ¶æ€ç®¡ç† MobX</h2> <p>è·Ÿè¿™ç¯‡ <a href="https://juejin.im/post/5d3faa3a5188255d2e32c6e3" target="_blank" rel="noopener noreferrer">React+Typescript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„å•é¡µé¢ SPA é¡¹ç›®é‡Œçš„å·®ä¸å¤šï¼Œåªæ˜¯æœåŠ¡ç«¯æ¸²æŸ“ æ²¡æœ‰ <code>window</code>ï¼›æ‰€ä»¥ç¼“å­˜è¿™é‡Œå…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æµè§ˆå™¨ï¼Œç„¶åå†å»ä½¿ç”¨æµè§ˆå™¨ API( <code>sessionStorage</code> )ï¼›</p> <p>ä¸è¿‡åˆ·æ–°ä¼šæœ‰ä¸€ä¸ªæ•°æ®å˜åŒ–çš„è¿‡ç¨‹ï¼Œå› ä¸ºå®é™…ä¸Š <code>_app.txs</code> æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ï¼Œç¼“å­˜æ˜¯åœ¨æµè§ˆå™¨æ¢å¤çš„ï¼Œæœ‰ä¸ªæ—¶é—´å·®ï¼Œè€Œä¸”ä¼šæœ‰è­¦å‘Š(å…¶å®å¯ä»¥å¿½ç•¥ï¼ŒæœåŠ¡å™¨è·Ÿå®¢æˆ·ç«¯çš„è¿™ä¸ªç¼“å­˜ä¸éœ€è¦åŒæ­¥ï¼Œä½¿ç”¨ <code>sessionStorage</code> ä¹Ÿæ˜¯å› ä¸ºä¸éœ€è¦é•¿ä¹…ç¼“å­˜ï¼Œå½“ç„¶å¯ä»¥æ ¹æ®éœ€è¦æ”¹ä¸º <code>localStorage</code> )ï¼Œæ ¹æ®éœ€æ±‚å–èˆå§</p> <blockquote><p>å•é¡µé¢ SPA å› ä¸ºæ˜¯åœ¨æµè§ˆå™¨æ¸²æŸ“æ‰€ä»¥ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜</p></blockquote> <p><img src="https://s1.ax1x.com/2020/06/20/NltwcR.png" alt="é¢„è§ˆå›¾"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> isBroswer<span class="token operator">:</span> boolean <span class="token operator">=</span> process<span class="token punctuation">.</span>browser<span class="token punctuation">;</span>
</code></pre></div><h3 id="_10-1-é¡¹ç›®å…¥å£"><a href="#_10-1-é¡¹ç›®å…¥å£" class="header-anchor">#</a> 10.1 é¡¹ç›®å…¥å£</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/pages/_app.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextComponentType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;next&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App<span class="token punctuation">,</span> <span class="token punctuation">{</span> AppProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/app'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'../store'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>
  Component<span class="token operator">:</span> NextComponentType<span class="token punctuation">,</span>
  pageProps<span class="token operator">:</span> AppProps<span class="token punctuation">,</span>
  router<span class="token operator">:</span> Router
<span class="token punctuation">}</span>

<span class="token comment">/**
 * App
 */</span>
<span class="token keyword">class</span> <span class="token class-name">myApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> Props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'router: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'router: '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> pageProps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Provider <span class="token punctuation">{</span><span class="token operator">...</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>pageProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> myApp<span class="token punctuation">;</span>
</code></pre></div><h3 id="_10-2-æ¨¡å—"><a href="#_10-2-æ¨¡å—" class="header-anchor">#</a> 10.2 æ¨¡å—</h3> <p>ç›‘å¬æ•°æ®ä½¿ç”¨ <code>autorun</code>ï¼Œä¼šåœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡ï¼›ç„¶åç”¨ <code>toJS</code> å°†æ¨¡å—è½¬åŒ–ä¸º <code>JSå¯¹è±¡</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/store/home.ts</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> mobx <span class="token keyword">from</span> <span class="token string">'mobx'</span><span class="token punctuation">;</span>

<span class="token comment">// ç¦æ­¢åœ¨ action å¤–ç›´æ¥ä¿®æ”¹ state</span>
mobx<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> enforceActions<span class="token operator">:</span> <span class="token string">&quot;observed&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> action<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> runInAction<span class="token punctuation">,</span> autorun <span class="token punctuation">}</span> <span class="token operator">=</span> mobx<span class="token punctuation">;</span>

<span class="token keyword">const</span> isBroswer<span class="token operator">:</span> boolean <span class="token operator">=</span> process<span class="token punctuation">.</span>browser<span class="token punctuation">;</span>

<span class="token comment">/**
 * æ‰€ä»¥ç¼“å­˜è¿™é‡Œå…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æµè§ˆå™¨ï¼Œç„¶åå†å»ä½¿ç”¨æµè§ˆå™¨ API( `sessionStorage` )ï¼›
 * ä¸è¿‡ä¼šæœ‰ä¸€ä¸ªé—ªç°çš„è¿‡ç¨‹ï¼Œå› ä¸ºå®é™…ä¸Š `_app.txs` æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ï¼Œç¼“å­˜æ˜¯åœ¨æµè§ˆå™¨æ¢å¤çš„ï¼Œ
 * æœ‰ä¸ªæ—¶é—´å·®ï¼Œè€Œä¸”ä¼šæœ‰è­¦å‘Šï¼Œæ ¹æ®éœ€æ±‚å–èˆå§
 */</span>
<span class="token keyword">let</span> cache <span class="token operator">=</span> isBroswer <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'homeStore'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆå§‹åŒ–æ•°æ®</span>
<span class="token keyword">let</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    time<span class="token operator">:</span> <span class="token string">'2019-11-20'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç¼“å­˜æ•°æ®</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isBroswer <span class="token operator">&amp;&amp;</span> cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>initialState<span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token punctuation">{</span>
  @observable
  <span class="token keyword">public</span> count <span class="token operator">=</span> initialState<span class="token punctuation">.</span>count<span class="token punctuation">;</span>

  @observable
  <span class="token keyword">public</span> data <span class="token operator">=</span> initialState<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

  @computed
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>time<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @action
  <span class="token keyword">public</span> <span class="token function-variable function">setCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_count<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> _count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @action
  <span class="token keyword">public</span> <span class="token function-variable function">setCountAsync</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">_count<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">runInAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> _count<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// public setCountFlow = flow(function *(_count: number) {</span>
  <span class="token comment">//   yield setTimeout(() =&gt; {}, 1000);</span>
  <span class="token comment">//   this.count = _count;</span>
  <span class="token comment">// })</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> homeStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ•°æ®å˜åŒ–åè§¦å‘ï¼Œæ•°æ®ç¼“å­˜</span>
<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> mobx<span class="token punctuation">.</span><span class="token function">toJS</span><span class="token punctuation">(</span>homeStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
  isBroswer <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'homeStore'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> type homeStoreType <span class="token operator">=</span> <span class="token keyword">typeof</span> homeStore<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> homeStore<span class="token punctuation">;</span>
</code></pre></div><h3 id="_10-3-æ¨¡å—ç®¡ç†è¾“å‡º"><a href="#_10-3-æ¨¡å—ç®¡ç†è¾“å‡º" class="header-anchor">#</a> 10.3 æ¨¡å—ç®¡ç†è¾“å‡º</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/store/index.ts</span>
<span class="token keyword">import</span> homeStore <span class="token keyword">from</span> <span class="token string">'./home'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * ä½¿ç”¨ mobx çŠ¶æ€ç®¡ç†
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  homeStore<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_10-4-ç»„ä»¶ä½¿ç”¨"><a href="#_10-4-ç»„ä»¶ä½¿ç”¨" class="header-anchor">#</a> 10.4 ç»„ä»¶ä½¿ç”¨</h3> <p>è¿™é‡Œæ˜¯å‡½æ•°ç»„ä»¶çš„ä½¿ç”¨ï¼Œç±»ç»„ä»¶çš„ä½¿ç”¨å¯ä»¥çœ‹ <a href="https://juejin.im/post/5d3faa3a5188255d2e32c6e3#heading-27" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/pages/detail.tsx</span>
<span class="token keyword">import</span> Head <span class="token keyword">from</span> <span class="token string">'next/head'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject<span class="token punctuation">,</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> homeStoreType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/home'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Row <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@/components/layout'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'@/styles/detail.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Detail</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> homeStore<span class="token operator">:</span> homeStoreType <span class="token operator">=</span> props<span class="token punctuation">.</span>homeStore<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Detail<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>detail<span class="token punctuation">}</span><span class="token operator">&gt;</span>This is the detail page<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      id<span class="token operator">:</span> <span class="token punctuation">{</span>router<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Row<span class="token operator">&gt;</span>count<span class="token operator">:</span> <span class="token punctuation">{</span>homeStore<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Row<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> homeStore<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>homeStore<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        count<span class="token operator">++</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> homeStore<span class="token punctuation">.</span><span class="token function">setCountAsync</span><span class="token punctuation">(</span>homeStore<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>countAsync<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Detail<span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * åœ¨å½“å‰è·¯ç”±åˆ·æ–°çš„è¯ï¼Œcontext.req ä¸ºçœŸï¼ŒæœåŠ¡ç«¯æ‰æœ‰ req/resï¼Œåœ¨å‘½ä»¤è¡Œæ‰“å° 'broswer'ï¼›
   * å¦‚æœæ˜¯å…¶ä»–è·¯ç”±è·³è½¬è¿‡æ¥æ²¡æœ‰åˆ·æ–°é¡µé¢çš„è¯ï¼Œcontext.req ä¸ºå‡ï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰“å°,
   * æ­¤æ—¶ document.title æ˜¯ è·³è½¬ä¹‹å‰çš„é¡µé¢ titleï¼›
   */</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render-type: '</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>req <span class="token operator">?</span> <span class="token string">'server'</span> <span class="token operator">:</span> <span class="token string">'broswer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> <span class="token string">'detail'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> DetailWithMobx <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'homeStore'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">observer</span><span class="token punctuation">(</span>Detail<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DetailWithMobx<span class="token punctuation">;</span>
</code></pre></div><h2 id="_11ã€æœåŠ¡ç«¯"><a href="#_11ã€æœåŠ¡ç«¯" class="header-anchor">#</a> 11ã€æœåŠ¡ç«¯</h2> <h3 id="_11-1-server-ts"><a href="#_11-1-server-ts" class="header-anchor">#</a> 11.1 server.ts</h3> <p><code>server.ts</code> æ”¹åŠ¨åï¼Œéœ€è¦åœ¨å‘½ä»¤è¡Œæ‰‹åŠ¨æ‰§è¡Œ <code>tsc server.ts</code> ç”Ÿæˆ <code>server.js</code>ï¼Œæ‰èƒ½æ‰§è¡Œï¼ˆæš‚æ—¶å°±è¿™ä¹ˆæå§ï¼‰ï¼›åœ¨ npm script é‡Œé¢ç›´æ¥å†™å¥½å°± ok äº†ï¼›ä¸çŸ¥é“æ€ä¹ˆè‡ªåŠ¨ç¼–è¯‘+é‡å¯æœåŠ¡</p> <h4 id="next-opts-object"><a href="#next-opts-object" class="header-anchor">#</a> next(opts: object)</h4> <p>opts æœ‰ä»¥ä¸‹å±æ€§ï¼š</p> <ul><li>dev (bool): æ˜¯å¦å¼€å‘ç¯å¢ƒ development - é»˜è®¤ false</li> <li>dir (string): Next é¡¹ç›®çš„ä½ç½® - é»˜è®¤ '.'</li> <li>quiet (bool): éšè—åŒ…å«æœåŠ¡å™¨ä¿¡æ¯çš„é”™è¯¯æ¶ˆæ¯ - é»˜è®¤ false</li> <li>conf (object): ä¸åœ¨ next.config.js ä¸­çš„å¯¹è±¡ä¸€æ · - é»˜è®¤ {}</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  dev<span class="token punctuation">,</span>
  dir<span class="token operator">:</span> <span class="token string">'.'</span><span class="token punctuation">,</span>
  quiet<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  conf<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="åŠ¨æ€èµ„æºå‰ç¼€-assetprefix"><a href="#åŠ¨æ€èµ„æºå‰ç¼€-assetprefix" class="header-anchor">#</a> åŠ¨æ€èµ„æºå‰ç¼€ assetPrefix</h4> <p>æ¯”å¦‚æœ¬åœ°ã€çº¿ä¸Šä½¿ç”¨ cdn çš„è¯èµ„æºå°±å’Œé¡µé¢çš„æœåŠ¡å™¨ä¸æ˜¯åŒä¸€å°äº†</p> <p><img src="https://s1.ax1x.com/2020/06/20/NltW3d.png" alt="é¢„è§ˆå›¾"></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// server.ts</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> http <span class="token keyword">from</span> <span class="token string">'http'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dev <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> handle <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Req</span> <span class="token keyword">extends</span> <span class="token class-name">http<span class="token punctuation">.</span>IncomingMessage</span> <span class="token punctuation">{</span>
  params<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

app
  <span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">serverRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ex<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">serverRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// apiæ¥å£</span>
  <span class="token keyword">const</span> controllers <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./server/controller'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> apiRoute <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// '/web';</span>
  server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>apiRoute<span class="token punctuation">,</span> controllers<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åŒ¹é…URLä¸º `/` çš„è·¯ç”±ï¼Œç„¶åæ¸²æŸ“ `/` å¯¹åº”çš„ `page/index.tsx` æ–‡ä»¶</span>
  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Req<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åŒ¹é…URLä¸º `/about` çš„è·¯ç”±ï¼Œç„¶åæ¸²æŸ“ `/about` å¯¹åº”çš„ `page/about.tsx` æ–‡ä»¶</span>
  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Req<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'/about'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åŒ¹é…URLä¸º `/detail/:id` çš„è·¯ç”±ï¼Œæ·»åŠ  `params å‚æ•°`ï¼Œç„¶åæ¸²æŸ“ `/detail` å¯¹åº”çš„ `page/detail.tsx` æ–‡ä»¶</span>
  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/detail/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> Req<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'/detail'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> http<span class="token punctuation">.</span>IncomingMessage<span class="token punctuation">,</span> res<span class="token operator">:</span> http<span class="token punctuation">.</span>ServerResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt; Ready on http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_11-2-å†™ä¸ªæ¥å£"><a href="#_11-2-å†™ä¸ªæ¥å£" class="header-anchor">#</a> 11.2 å†™ä¸ªæ¥å£</h3> <p>ä½¿ç”¨é»˜è®¤çš„ express</p> <blockquote><p>æœ¬æ¥æ˜¯è¦æ”¹æˆ koa çš„ï¼Œä½†æ˜¯è·¯ç”±é‚£é‡Œé¡µé¢ä¼šæ¸²æŸ“ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“çš„é¡µé¢çœ‹ç½‘ç»œè¯·æ±‚ç¡®æ˜¯ 404ï¼Œå†…å®¹å€’æ˜¯æ¸²æŸ“å‡ºæ¥äº†(åœ¨ server-koa.ts )ã€‚ã€‚ã€‚</p></blockquote> <h4 id="æ¨¡å—"><a href="#æ¨¡å—" class="header-anchor">#</a> æ¨¡å—</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// server/controllers/user.js</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/userInfo/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'id: '</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'å°å±å­©'</span><span class="token punctuation">,</span>
      sex<span class="token operator">:</span> <span class="token string">'ç”·'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Router<span class="token punctuation">;</span>
</code></pre></div><h4 id="æ¨¡å—ç®¡ç†"><a href="#æ¨¡å—ç®¡ç†" class="header-anchor">#</a> æ¨¡å—ç®¡ç†</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// server/controller.js</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./controllers/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Router<span class="token punctuation">;</span>
</code></pre></div><h4 id="æŒ‚è½½åˆ°-server-æœåŠ¡"><a href="#æŒ‚è½½åˆ°-server-æœåŠ¡" class="header-anchor">#</a> æŒ‚è½½åˆ° server æœåŠ¡</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// server.ts</span>
<span class="token comment">// ...</span>

<span class="token keyword">function</span> <span class="token function">serverRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// apiæ¥å£</span>
  <span class="token keyword">const</span> controllers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./server/controller'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> apiRoute <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// '/web';</span>
  server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>apiRoute<span class="token punctuation">,</span> controllers<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="æ¥å£è°ƒç”¨"><a href="#æ¥å£è°ƒç”¨" class="header-anchor">#</a> æ¥å£è°ƒç”¨</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/pages/about.tsx</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/user/userInfo/2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fetch: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>nginx åœ¨æœ¬åœ°éƒ¨ç½²ï¼Œè¯·æ±‚è¢«ä»£ç†(<code>proxy_pass</code>)åˆ° <code>next-test</code> çš„æœåŠ¡(pm2 å¯åŠ¨)ï¼Œè¯·æ±‚å“åº”çš„æˆªå›¾ï¼š
<img src="https://s1.ax1x.com/2020/06/20/NltR9H.png" alt="é¢„è§ˆå›¾"></p> <h2 id="_12ã€æ„å»º"><a href="#_12ã€æ„å»º" class="header-anchor">#</a> 12ã€æ„å»º</h2> <p>npm script:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token operator">...</span>
 <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dev:tsc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc server.ts&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next build&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production node server.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
</code></pre></div><p>å¼€å‘ç¯å¢ƒï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>yarn dev
</code></pre></div><p>æ‰“åŒ…ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>yarn build
</code></pre></div><p>ç„¶åäº§ç”Ÿçš„ <code>next-build</code> æ–‡ä»¶å¤¹ (next-build æ˜¯é…ç½®å¥½çš„è¾“å‡ºç›®å½•)</p> <h2 id="_13ã€éƒ¨ç½²"><a href="#_13ã€éƒ¨ç½²" class="header-anchor">#</a> 13ã€éƒ¨ç½²</h2> <p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼ŒæŠŠé¡¹ç›®æ”¾åœ¨ nginx ä¸‹æ–°å»ºçš„ html æ–‡ä»¶å¤¹ä¸‹( <code>/usr/local/etc/nginx/html/next-test</code> ) å¯åŠ¨é¡¹ç›®å’Œ nginxï¼Œæµè§ˆå™¨è®¿é—®ä¸€ç›´éƒ½æ˜¯ 502ï¼ˆå•é¡µé¢ SPA çš„å€’æ˜¯æ­£å¸¸ï¼‰ã€‚ã€‚ã€‚æ”¾åˆ°åˆ«çš„ç›®å½•ä¸‹å¯åŠ¨å°±å¯ä»¥( <code>/usr/local/website/next-test</code> )ã€‚ã€‚ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯ macOS çš„åŸå› ï¼Œæ‰¾æ—¶é—´åœ¨ linux ä¸Šé¢è¯•è¯•ï½
æ‰€ä»¥æŠŠé¡¹ç›®éƒ½æ”¾ <code>/usr/local/website/</code> ä¸‹é¢äº†</p> <h3 id="_13-1-pm2"><a href="#_13-1-pm2" class="header-anchor">#</a> 13.1 pm2</h3> <p>ä½¿ç”¨ pm2ï¼Œå¯ä»¥åœ¨æœ¬æœºæµ‹è¯•ï¼Œä½†æ˜¯æœ€ç»ˆéƒ¨ç½²è¿˜æ˜¯æœåŠ¡å™¨</p> <div class="language- extra-class"><pre class="language-text"><code>yarn global add pm2
</code></pre></div><p>ç»ˆç«¯è¿›å…¥é¡¹ç›®ç›®å½•ä¸‹ï¼Œç„¶åï¼š</p> <h4 id="å…¨å‘½ä»¤"><a href="#å…¨å‘½ä»¤" class="header-anchor">#</a> å…¨å‘½ä»¤</h4> <div class="language- extra-class"><pre class="language-text"><code>pm2 start yarn --name &quot;next-test&quot; -- run start
</code></pre></div><h4 id="è„šæœ¬"><a href="#è„šæœ¬" class="header-anchor">#</a> è„šæœ¬</h4> <p>é¡¹ç›®æ ¹ç›®å½•ä¸‹ deploy.shï¼š</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#deploy.sh</span>
pm2 start <span class="token function">yarn</span> --name <span class="token string">&quot;next-test&quot;</span> -- run start
</code></pre></div><p>ç»ˆç«¯è¿›å…¥é¡¹ç›®ç›®å½•ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>. deploy.sh
</code></pre></div><p><img src="https://s1.ax1x.com/2020/06/20/Nlt6AO.png" alt="é¢„è§ˆå›¾"></p> <p>å‡ ä¸ª pm2 å‘½ä»¤ï¼š</p> <ul><li>pm2 show [id]: æ˜¾ç¤ºæŸä¸ª pm2 åº”ç”¨çš„ä¿¡æ¯</li> <li>pm2 list: æ˜¾ç¤ºæ‰€æœ‰çš„ pm2 åº”ç”¨çš„æ¦‚è§ˆ</li> <li>pm2 stop [id]/all: åœæ­¢æŸä¸ªåº”ç”¨ï¼Œå¯ä»¥å¤šä¸ªåˆ é™¤ï¼Œç©ºæ ¼éš”å¼€æˆ–è€…å…¨éƒ¨åœæ­¢</li> <li>pm2 delete [id]/all: åˆ é™¤æŸä¸ªåº”ç”¨ï¼Œå¯ä»¥å¤šä¸ªåˆ é™¤ï¼Œç©ºæ ¼éš”å¼€æˆ–è€…å…¨éƒ¨åˆ é™¤</li> <li>pm2 monit: ç›‘å¬ pm2 å¯åŠ¨çš„åº”ç”¨çŠ¶æ€</li> <li>pm2 restart: é‡å¯</li> <li>ç­‰ç­‰</li></ul> <h3 id="_13-2-nginx"><a href="#_13-2-nginx" class="header-anchor">#</a> 13.2 Nginx</h3> <p>pm2 æœåŠ¡è¿è¡Œç¨‹åºï¼Œnginx è´Ÿè´£å¼€å¯ http æœåŠ¡ï¼Œè¿™é‡Œåªæ˜¯ç®€å•çš„ä½¿ç”¨</p> <h4 id="å‡ ä¸ª-nginx-å‘½ä»¤"><a href="#å‡ ä¸ª-nginx-å‘½ä»¤" class="header-anchor">#</a> å‡ ä¸ª nginx å‘½ä»¤</h4> <ul><li>nginx: å¯åŠ¨ nginx</li> <li>nginx -t: æµ‹è¯• nginx.conf é…ç½®æ˜¯å¦æ­£ç¡®</li> <li>nginx -s stop: åœæ­¢ nginx</li> <li>nginx -s reload: é‡å¯ nginx</li> <li>ç­‰ç­‰</li></ul> <h4 id="åœ¨æœ¬åœ°æµ‹è¯•çš„é…ç½®ï¼ˆmac"><a href="#åœ¨æœ¬åœ°æµ‹è¯•çš„é…ç½®ï¼ˆmac" class="header-anchor">#</a> åœ¨æœ¬åœ°æµ‹è¯•çš„é…ç½®ï¼ˆmac)</h4> <blockquote><p>ç½‘ç«™ä»£ç éƒ½æ”¾ <code>/usr/local/website</code> ä¸‹</p></blockquote> <p>nginx.conf é…ç½®ï¼š</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>
<span class="token comment">#user  nobody;</span>
<span class="token keyword">worker_processes</span>  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
<span class="token comment">#error_log  logs/error.log  info;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


<span class="token keyword">events</span> <span class="token punctuation">{</span>
    <span class="token keyword">worker_connections</span>  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span>       mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>
    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>

    <span class="token comment">#log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</span>
    <span class="token comment">#                  '$status $body_bytes_sent &quot;$http_referer&quot; '</span>
    <span class="token comment">#                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';</span>

    <span class="token comment">#access_log  logs/access.log  main;</span>

    <span class="token keyword">sendfile</span>        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    <span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token keyword">gzip</span>  on<span class="token punctuation">;</span>

    <span class="token keyword">upstream</span> next<span class="token operator">-</span>test <span class="token punctuation">{</span>
	    <span class="token keyword">server</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">;</span> <span class="token comment"># next-test å¯åŠ¨çš„æœåŠ¡ç«¯å£</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># next-test</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span> <span class="token comment">#è¿™é‡Œé…ç½®åŸŸå</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        <span class="token keyword">error_page</span>  <span class="token number">404</span>              <span class="token operator">/</span><span class="token number">404.</span>html<span class="token punctuation">;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
            <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">;</span> <span class="token comment">#è¯·æ±‚å°†ä¼šè½¬å‘åˆ°next-testçš„nodeæœåŠ¡ä¸‹</span>
            <span class="token keyword">proxy_redirect</span> off<span class="token punctuation">;</span>

            <span class="token comment"># root   html;</span>
            <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># movie-db: å•é¡µé¢SPA</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>       <span class="token number">81</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span> <span class="token comment">#è¿™é‡Œé…ç½®åŸŸå</span>

        <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>website<span class="token operator">/</span>movie<span class="token operator">-</span>db<span class="token operator">/</span><span class="token punctuation">;</span>

        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span><span class="token operator">/</span> @router<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> @router <span class="token punctuation">{</span>
            <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">*</span>$<span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html last<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
            <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment"># HTTPS server</span>
    <span class="token comment">#</span>
    <span class="token comment">#server {</span>
    <span class="token comment">#    listen       443 ssl;</span>
    <span class="token comment">#    server_name  localhost;</span>

    <span class="token comment">#    ssl_certificate      cert.pem;</span>
    <span class="token comment">#    ssl_certificate_key  cert.key;</span>

    <span class="token comment">#    ssl_session_cache    shared:SSL:1m;</span>
    <span class="token comment">#    ssl_session_timeout  5m;</span>

    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>

    <span class="token comment">#    location / {</span>
    <span class="token comment">#        root   html;</span>
    <span class="token comment">#        index  index.html index.htm;</span>
    <span class="token comment">#    }</span>
    <span class="token comment">#}</span>
    <span class="token keyword">include</span> servers<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="åç»­è¦æçš„ä¸œè¥¿"><a href="#åç»­è¦æçš„ä¸œè¥¿" class="header-anchor">#</a> åç»­è¦æçš„ä¸œè¥¿</h2> <h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="header-anchor">#</a> æ•°æ®åº“</h3> <p>MySQL/MongoDB è¿™ä¸¤ä¸ªå§</p> <h3 id="grahpql"><a href="#grahpql" class="header-anchor">#</a> GrahpQL</h3> <p>å¥½åƒå« <strong>API æŸ¥è¯¢è¯­è¨€</strong>ï¼Œä¸»è¦åšæ¥å£èšåˆçš„ä¸€ä¸ªä¸œè¥¿å§ï¼›ä¸ºçš„æ˜¯å¯¹ åç«¯å¾®æœåŠ¡æ¥å£çš„èšåˆï¼Œç„¶åå‰ç«¯é¡µé¢åªè¦è¯·æ±‚ <strong>ç»è¿‡èšåˆçš„æ¥å£</strong>ï¼Œå°±ä¸éœ€è¦å¤šæ¬¡è¯·æ±‚ <strong>åç«¯å¾®æœåŠ¡å°æ¥å£</strong> äº†ï¼›ä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹</p> <h2 id="ä¸€äº›é—®é¢˜"><a href="#ä¸€äº›é—®é¢˜" class="header-anchor">#</a> ä¸€äº›é—®é¢˜</h2> <ul><li><p>ä»ä¸€çº§è·¯ç”±è¿›å…¥äºŒçº§è·¯ç”±ç„¶ååˆ·æ–°ï¼Œæµè§ˆå™¨åé€€ï¼ŒURL å˜äº†ä½†æ˜¯å†…å®¹ä¸å˜ï¼è¿™æ˜¯ä¸ª bug, <a href="https://github.com/zeit/next.js/issues/9378" target="_blank" rel="noopener noreferrer">issues#9378<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://github.com/zeit/next.js/pull/9380" target="_blank" rel="noopener noreferrer">è§£å†³<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>åœ¨æŸäº›è·¯ç”±åˆ·æ–°åï¼Œè¿›å…¥å…¶ä»–è·¯ç”±å¯¼è‡´æ ·å¼ä¸¢å¤±ï¼ŒæŸ¥çœ‹è¯·æ±‚ <code>styles.chunk.css</code> å¹¶æ²¡æœ‰ç›¸å…³çš„ cssï¼Œä½†æ˜¯ <code>scss+css modules</code> å€’æ˜¯è½¬åŒ–å¥½äº†ï¼ˆè²Œä¼¼åªè¦å¼€å‘ç¯å¢ƒä¼šï¼Œæ‰“åŒ…åæ²¡é‡åˆ°è¿‡ï¼‰</p></li> <li><p>next.js ä½¿ç”¨ koa å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“çš„é¡µé¢çœ‹ç½‘ç»œè¯·æ±‚é‚£é‡Œä¼šæ˜¯ 404ï¼Œä½†æ˜¯é¡µé¢æ¸²æŸ“å‡ºæ¥äº†ï¼›è¦ä¹ˆå°±æ˜¯åŠ¨æ€è·¯ç”±(<code>/detail/:id</code>) 404ã€‚ã€‚ã€‚å•ç‹¬ä½¿ç”¨ koa æ­å»ºçš„ node.js æœåŠ¡å¹¶ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜( <a href="https://github.com/zero9527/mdnote-service" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> )</p></li></ul> <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="header-anchor">#</a> å‚è€ƒ</h2> <ul><li>æ–‡æ¡£ <a href="https://nextjs.org/docs" target="_blank" rel="noopener noreferrer">nextjs.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>è¿˜æœ‰ç½‘ä¸Šä¸€äº›å¤§ä½¬çš„æ–‡ç« </li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/react/react-keep-alive.html" class="prev">
        React åˆ—è¡¨ keep-alive çš„ä¸€ç§å†™æ³•
      </a></span> <span class="next"><a href="/react/React-Hook.html">
        React Hook ä¸€äº›ç”¨æ³•
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5ad30cc8.js" defer></script><script src="/assets/js/2.2ae201dd.js" defer></script><script src="/assets/js/22.f01f7385.js" defer></script>
  </body>
</html>
